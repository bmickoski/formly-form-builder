<div class="fb-app">
  <div class="fb-topbar">
    <button mat-raised-button color="primary" (click)="openPreview()">
      <mat-icon>visibility</mat-icon>
      Preview
    </button>

    <button mat-button (click)="openExport()">
      <mat-icon>download</mat-icon>
      Export Formly JSON
    </button>

    <button mat-button (click)="openExportBuilder()">
      <mat-icon>dataset</mat-icon>
      Export Builder JSON
    </button>

    <button mat-button (click)="openImport()">
      <mat-icon>upload</mat-icon>
      Import Builder JSON
    </button>

    <button mat-button (click)="openImportFormly()">
      <mat-icon>transform</mat-icon>
      Import Formly JSON
    </button>
    <button mat-button (click)="openImportPalette()">
      <mat-icon>palette</mat-icon>
      Load Palette JSON
    </button>
    <button mat-button (click)="resetPalette()">
      <mat-icon>restart_alt</mat-icon>
      Reset Palette
    </button>

    <mat-form-field appearance="outline" class="fb-starter-layout-field">
      <mat-label>Starter layout</mat-label>
      <mat-select [value]="presetToApply()" (selectionChange)="presetToApply.set($event.value)">
        @for (preset of store.presets; track preset.id) {
          <mat-option [value]="preset.id">{{ preset.title }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <button mat-button (click)="applyPreset()">
      <mat-icon>auto_awesome</mat-icon>
      Apply Layout
    </button>

    <div class="fb-preset-preview">
      <div class="fb-preset-thumb" aria-hidden="true">
        @for (row of selectedPreset.thumbnailRows; track $index) {
          <div class="fb-preset-thumb-row" [style.width.%]="row"></div>
        }
      </div>
      <div class="fb-preset-preview-content">
        <div class="fb-preset-preview-title">{{ selectedPreset.title }}</div>
        <div class="fb-preset-preview-description">{{ selectedPreset.description }}</div>
        <div class="fb-preset-preview-highlights">{{ selectedPreset.highlights.join(' | ') }}</div>
      </div>
    </div>

    <button mat-button (click)="store.undo()" [disabled]="!store.canUndo()">
      <mat-icon>undo</mat-icon>
      Undo
    </button>

    <button mat-button (click)="store.redo()" [disabled]="!store.canRedo()">
      <mat-icon>redo</mat-icon>
      Redo
    </button>
    <button mat-button (click)="toggleDiagnostics()">
      <mat-icon>rule</mat-icon>
      Diagnostics ({{ diagnosticsSummary() }})
    </button>

    <mat-form-field appearance="outline" class="fb-preview-ui-field">
      <mat-label>Preview UI</mat-label>
      <mat-select [value]="store.renderer()" (selectionChange)="store.setRenderer($event.value)">
        <mat-option value="material">Material</mat-option>
        <mat-option value="bootstrap">Bootstrap</mat-option>
      </mat-select>
    </mat-form-field>

    <span class="fb-toolbar-spacer"></span>

    <button mat-button color="warn" (click)="clear()">
      <mat-icon>delete</mat-icon>
      Clear
    </button>
  </div>

  @if (diagnosticsOpen()) {
    <div class="fb-diagnostics">
      <div class="fb-diagnostics-title">Diagnostics</div>
      @if (store.diagnostics().diagnostics.length === 0) {
        <div class="fb-hint">No issues found.</div>
      } @else {
        @for (item of firstDiagnostics(); track $index) {
          <div class="fb-diagnostics-item" [class.fb-diagnostics-item-error]="item.severity === 'error'">
            <strong>{{ item.severity.toUpperCase() }}</strong
            >:
            {{ item.message }}
            @if (item.nodeId) {
              <span class="fb-diagnostics-node">(node {{ item.nodeId }})</span>
            }
          </div>
        }
      }
    </div>
  }

  <div class="fb-workspace" cdkDropListGroup>
    <div class="fb-panel">
      <app-builder-palette />
    </div>

    <div class="fb-canvas">
      <app-builder-canvas />
    </div>

    <div class="fb-panel right">
      <app-builder-inspector />
    </div>
  </div>
</div>
